üß† ‡∏ó‡∏≥‡πÑ‡∏° Docker ‡∏ñ‡∏∂‡∏á‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ ?
‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà Docker ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ

‚úî 1) Container Log ‡πÇ‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
‚Ä¢ ‡∏ó‡∏∏‡∏Å container ‡∏à‡∏∞‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå log ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô
/var/lib/docker/containers/<container-id>/<container-id>-json.log
‚Ä¢ ‡∏ñ‡πâ‡∏≤ service ‡∏°‡∏µ event ‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÄ‡∏ä‡πà‡∏ô web server, cron, app ‡∏ó‡∏µ‡πà print ‡πÄ‡∏¢‡∏≠‡∏∞ ‚Üí log ‡πÇ‡∏ï‡∏à‡∏ô‡πÄ‡∏õ‡πá‡∏ô GB

‚û° ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1 ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ Disk ‡πÄ‡∏ï‡πá‡∏°

‚∏ª

‚úî 2) Dangling Images / Old Layers ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö

‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏∏‡∏ì:
‚Ä¢ pull image ‡πÉ‡∏´‡∏°‡πà
‚Ä¢ build image ‡πÉ‡∏´‡∏°‡πà
‚Ä¢ update container

Docker ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö layer ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ ‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á ‚Üí storage ‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ

‚∏ª

‚úî 3) Stopped Containers ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö

Container ‡∏ó‡∏µ‡πà stop ‡πÅ‡∏•‡πâ‡∏ß ‡∏¢‡∏±‡∏á Âç† ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà

‚∏ª

‚úî 4) Unused Volumes ‡∏™‡∏∞‡∏™‡∏°

Volume ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏à‡∏≤‡∏Å service ‡πÄ‡∏î‡∏¥‡∏°‡πÜ ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏≠‡∏á ‡∏ñ‡∏∂‡∏á container ‡∏à‡∏∞‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏ï‡∏≤‡∏°

‚∏ª

‚úî 5) Build Cache ‡πÇ‡∏ï‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ

‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥ docker build ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á Cache ‡∏à‡∏∞‡∏™‡∏∞‡∏™‡∏°

‚∏ª

üõ† ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ + ‡∏™‡∏±‡πà‡∏á‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

üî• 1) ‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ Docker ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£

docker system df

‚∏ª

üßπ 2) ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏î)

docker system prune -a

‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
‚Ä¢ -a ‚Üí ‡∏•‡∏ö unused images ‡∏î‡πâ‡∏ß‡∏¢
‚Ä¢ ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô

‚∏ª

üßπ 3) ‡∏•‡∏ö logs ‡∏Ç‡∏≠‡∏á container ‡∏ó‡∏µ‡πà‡πÇ‡∏ï‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

‡πÄ‡∏ä‡πá‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î logs:

sudo du -sh /var/lib/docker/containers/_/_-json.log

‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå log ‡∏ó‡∏¥‡πâ‡∏á:

sudo truncate -s 0 /var/lib/docker/containers/<id>/<id>-json.log

‚∏ª

üßπ 4) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ Docker ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏ô‡∏≤‡∏î Logs (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå config:

sudo nano /etc/docker/daemon.json

‡πÄ‡∏û‡∏¥‡πà‡∏°:

{
"log-driver": "json-file",
"log-opts": {
"max-size": "10m",
"max-file": "3"
}
}

‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß restart docker:

sudo systemctl restart docker

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
‚Ä¢ log ‡πÑ‡∏°‡πà‡πÇ‡∏ï‡πÄ‡∏Å‡∏¥‡∏ô 10MB ‡∏ï‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà 3 ‡πÑ‡∏ü‡∏•‡πå
‚Ä¢ ‡πÑ‡∏°‡πà‡∏ö‡∏ß‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏´‡∏•‡∏≤‡∏¢ GB ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ

‚∏ª

üßπ 5) ‡∏•‡∏ö volumes ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ

‡∏î‡∏π volumes ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:

docker volume ls

‡∏•‡∏ö unused:

docker volume prune

‚∏ª

üßπ 6) ‡∏•‡∏ö container ‡∏ó‡∏µ‡πà‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

docker container prune

‚∏ª

üßπ 7) ‡∏•‡∏ö image ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß

docker image prune -a

‚∏ª

‚ö† ‡∏ñ‡πâ‡∏≤‡∏î‡∏¥‡∏™‡∏Å‡πå‡∏¢‡∏±‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Å‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ

‚úî /var/lib/docker ‡πÇ‡∏ï‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥

sudo du -sh /var/lib/docker/\*

‡∏ñ‡πâ‡∏≤‡∏û‡∏ö overlay2 ‡πÇ‡∏ï‡∏°‡∏≤‡∏Å ‚Üí ‡πÄ‡∏õ‡πá‡∏ô layer cache

‚∏ª

‚úî ‡∏°‡∏µ container log 20‚Äì100GB

‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÄ‡∏ä‡πà‡∏ô nginx, Laravel, NodeJS print ‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å

‚∏ª

üéØ ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô (‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢)

Docker ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏£‡∏≤‡∏∞:
‚Ä¢ log files ‡πÇ‡∏ï
‚Ä¢ image ‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏ö
‚Ä¢ volume ‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà
‚Ä¢ build cache ‡∏™‡∏∞‡∏™‡∏°

‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:

1.  docker system prune -a
2.  ‡∏à‡∏≥‡∏Å‡∏±‡∏î log size (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
3.  ‡∏•‡∏ö volume ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ
4.  ‡∏•‡πâ‡∏≤‡∏á container/image ‡πÄ‡∏Å‡πà‡∏≤

‚∏ª

‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ú‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô bash script auto-clean Docker ‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡∏ö‡∏£‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏ö ‡∏ö‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!
